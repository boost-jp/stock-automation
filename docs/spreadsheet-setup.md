# スプレッドシート設定ガイド

## 概要
Google Sheetsを使ったポートフォリオ管理表の詳細設定方法

## 基本スプレッドシート構造

### シート1: ポートフォリオ管理
| A列 | B列 | C列 | D列 | E列 | F列 | G列 | H列 |
|-----|-----|-----|-----|-----|-----|-----|-----|
| 銘柄コード | 銘柄名 | 保有株数 | 取得単価 | 現在価格 | 評価額 | 損益 | 損益率 |
| 7203 | トヨタ | 100 | 2500 | =GOOGLEFINANCE("TYO:7203") | =C2*E2 | =F2-C2*D2 | =G2/(C2*D2) |

### シート2: 監視銘柄
| A列 | B列 | C列 | D列 | E列 | F列 |
|-----|-----|-----|-----|-----|-----|
| 銘柄コード | 銘柄名 | 目標買い価格 | 目標売り価格 | 現在価格 | アラート |
| 6758 | ソニー | 12000 | 15000 | =GOOGLEFINANCE("TYO:6758") | =IF(E2<=C2,"買い",IF(E2>=D2,"売り","")) |

### シート3: 判断アルゴリズム
| A列 | B列 | C列 | D列 | E列 | F列 | G列 | H列 |
|-----|-----|-----|-----|-----|-----|-----|-----|
| 銘柄コード | 現在価格 | MA5 | MA25 | RSI | 判断スコア | 推奨アクション | 信頼度 |

## 自動計算式の詳細

### 現在価格取得（E列）
```javascript
=GOOGLEFINANCE("TYO:7203")
```

### 評価額計算（F列）
```javascript
=C2*E2
```

### 損益計算（G列）
```javascript
=F2-C2*D2
```

### 損益率計算（H列）
```javascript
=G2/(C2*D2)
```

### 合計評価額（最下行）
```javascript
=SUM(F2:F10)
```

### 合計損益（最下行）
```javascript
=SUM(G2:G10)
```

## アラート計算式

### 監視銘柄アラート（F列）
```javascript
=IF(E2<=C2,"買い",IF(E2>=D2,"売り",""))
```

### 判断アルゴリズム（G列）
```javascript
=IF(AND(F2>G2,H2<=30,E2>F2),"強い買い",
  IF(AND(F2<G2,H2>=70,E2<F2),"強い売り",
    IF(OR(F2>G2,H2<=35),"買い検討",
      IF(OR(F2<G2,H2>=65),"売り検討","保持"))))
```

### 信頼度計算（H列）
```javascript
=IF(G2="強い買い",90,
  IF(G2="強い売り",85,
    IF(OR(G2="買い検討",G2="売り検討"),70,60)))
```

## 具体的な設定手順

### Step 1: 新しいスプレッドシート作成
1. Google Driveにアクセス
2. 「新規」→「Google スプレッドシート」
3. タイトルを「株式投資管理」に変更

### Step 2: シート構成の作成
1. シート名を「ポートフォリオ」に変更
2. 新しいシートを追加して「監視銘柄」
3. 新しいシートを追加して「判断アルゴリズム」

### Step 3: ヘッダー行の設定
**ポートフォリオシートのA1:H1**
```
銘柄コード | 銘柄名 | 保有株数 | 取得単価 | 現在価格 | 評価額 | 損益 | 損益率
```

**監視銘柄シートのA1:F1**
```
銘柄コード | 銘柄名 | 目標買い価格 | 目標売り価格 | 現在価格 | アラート
```

### Step 4: サンプルデータの入力
**ポートフォリオシート A2:D2**
```
7203 | トヨタ自動車 | 100 | 2500
```

**E2セルに現在価格取得式**
```
=GOOGLEFINANCE("TYO:7203")
```

**F2セルに評価額計算式**
```
=C2*E2
```

**G2セルに損益計算式**
```
=F2-C2*D2
```

**H2セルに損益率計算式**
```
=G2/(C2*D2)
```

### Step 5: 書式設定
1. **数値書式**: E,F,G列を通貨形式に設定
2. **パーセント書式**: H列をパーセント形式に設定
3. **条件付き書式**: 
   - G列（損益）: 正の値は緑、負の値は赤
   - F列（アラート）: "買い"は青、"売り"は赤

### Step 6: データ検証
1. E2セルが正しい株価を表示することを確認
2. 各計算式が正常に動作することを確認
3. 市場時間外は前日終値が表示されることを確認

## トラブルシューティング

### GOOGLEFINANCE関数が動作しない場合
- 銘柄コードの形式を確認（例: "TYO:7203"）
- 市場開時間外の場合は前日終値が表示
- 上場廃止銘柄は#N/Aエラーが発生

### 計算式エラーの場合
- セル参照が正しいか確認
- データ型（数値/文字列）が適切か確認
- 空白セルでの除算エラーに注意

### 更新されない場合
- ブラウザのリロード
- GOOGLEFINANCE関数の再入力
- インターネット接続の確認

## 拡張設定

### 複数銘柄の一括設定
1. サンプル行（2行目）を下方向にコピー
2. 銘柄コードと銘柄名を変更
3. 取得単価と保有株数を入力

### 合計行の追加
**最下行に合計行を追加**
```
合計 | - | =SUM(C2:C10) | - | - | =SUM(F2:F10) | =SUM(G2:G10) | =G11/F11
```

### グラフの作成
1. データ範囲を選択（A1:H10）
2. 「挿入」→「グラフ」
3. 円グラフで銘柄別構成比を表示
4. 折れ線グラフで損益推移を表示

## セキュリティ設定

### 共有設定
1. 「共有」ボタンをクリック
2. 「リンクを知っている全員」を「制限付き」に変更
3. 必要に応じて特定のユーザーのみアクセス許可

### 編集権限
1. 重要な計算式セルを保護
2. 「データ」→「シートと範囲を保護」
3. 計算式の誤削除を防止

これで基本的なスプレッドシート設定が完了します。次は[Apps Script実装](apps-script.md)に進んでください。